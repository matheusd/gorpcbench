# https://taskfile.dev

version: '3'

vars:
  GREETING: Hello, World!

tasks:
  quickbench: 
    desc: Quick sanity check of benchmarks.
    cmds: 
      - go test -run Bench -bench Bench -benchtime 100ms
  
  runfullbench: 
    desc: Run full benchmark for producing results.
    cmds: 
      - go test -run Bench -bench Bench -benchtime 3s | tee www/last_benches.txt

  vizfullbench: 
    desc: Generate results HTML from last full benchmark run.
    cmds: 
      - vizb www/last_benches.txt  -t us -p "/w/n/s" -m KB -n "RPC Systems Comparison"  -o www/last_benches.html

  report:
    desc: Run full benchmark and regenerate report HTML.
    cmds:
      - task runfullbench
      - task vizfullbench

  main-result-imgs: 
    desc: Helper to plot images for the main results.
    cmds:
      - grep -E "(seq.*/nop|seq.*/tree|par.*/hex)" www/last_benches.txt > /tmp/bench.txt
      - python benchplot.py </tmp/bench.txt

